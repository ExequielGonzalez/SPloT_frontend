"use strict";(self["webpackChunksplot_frontend"]=self["webpackChunksplot_frontend"]||[]).push([[763],{9828:(e,t,a)=>{a.d(t,{Z$:()=>n,m_:()=>l,l8:()=>i,pO:()=>r,qE:()=>c,ZV:()=>d,xT:()=>p});const s="http://0.0.0.0:5000";async function o(e,t="GET"){let a={},s=await fetch(e,{method:`${t}`});return 200===s.status&&(a=await s.json()),{status:s.status,data:a}}async function n(){return await o(`${s}/api/v1/actives`)}async function l(){return await o(`${s}/api/v1/reports/countPlaces`)}async function i(e){const t=await o(`${s}/api/v1/vehicles/${e}`);if(200!==t.status)return t;const a=await o(`${s}/api/v1/entries/?vehicleId=${t.data.id}`);if(200!==a.status)return a;const n=await o(`${s}/api/v1/vehiclePhotos?entryId=${a.data[0].id}`);return 200!==n.status?n:await o(`${s}/api/v1/vehiclePhotos/photo/${n.data[0].id}`)}async function r(e){return await o(`${s}/api/v1/entries/${e}`,"DELETE")}async function c(e=1630805031,t=1631669031){return await o(`${s}/api/v1/reports/collected?since=${e}&until=${t}`)}async function d(e=1630805031,t=1631669031){return await o(`${s}/api/v1/reports/occupation?since=${e}&until=${t}`)}async function p(e=1630805031,t=1631669031){return await o(`${s}/api/v1/reports/paymentMethods?since=${e}&until=${t}`)}},6763:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ee});var s=a(3673);const o={class:"home-header q-pa-lg"};function n(e,t,a,n,l,i){const r=(0,s.up)("PlacesCounter"),c=(0,s.up)("SearchBar"),d=(0,s.up)("TablePlates"),p=(0,s.up)("q-page"),u=(0,s.up)("image-viewer");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(p,{class:"q-pa-md"},{default:(0,s.w5)((()=>[(0,s._)("section",o,[(0,s.Wm)(r,{title:"Lugares generales",places:e.parkPlaces},null,8,["places"]),(0,s.Wm)(r,{title:"Lugares motos",places:e.motorbikePlaces},null,8,["places"])]),(0,s.Wm)(c,{onResult:e.filterPlates,onSearchError:e.showEmptyTable,plates:JSON.parse(JSON.stringify(this.activePlates)),ref:"searchBarRef"},null,8,["onResult","onSearchError","plates"]),(0,s.Wm)(d,{plates:0!==JSON.parse(JSON.stringify(this.filteredPlates)).length?JSON.parse(JSON.stringify(this.filteredPlates)):this.emptyTable?[]:JSON.parse(JSON.stringify(this.activePlates)),onViewPhoto:e.showPhoto,onDeleteUser:e.deleteEntry},null,8,["plates","onViewPhoto","onDeleteUser"])])),_:1}),(0,s.Wm)(u,{ref:"imageViewerRef"},null,512)],64)}a(246);var l=a(8825),i=a(2323);(0,s.dD)("data-v-067c6f8a");const r={class:"q-pa-md"},c={class:"table__top"},d=(0,s._)("h6",null,"Patentes activas",-1),p=(0,s._)("strong",null,"Ver más",-1),u=(0,s._)("strong",null,"Borrar",-1);function m(e,t,a,o,n,l){const m=(0,s.up)("q-btn"),h=(0,s.up)("q-td"),f=(0,s.up)("q-tooltip"),g=(0,s.up)("q-table");return(0,s.wg)(),(0,s.iD)("div",r,[(0,s.Wm)(g,{dense:e.$q.screen.lt.md,title:"Plates",columns:e.columns,rows:e.plates,"row-key":"entryId","rows-per-page-options":[15]},{top:(0,s.w5)((()=>[(0,s._)("div",c,[d,(0,s.Wm)(m,{color:"primary",label:"Añadir ingreso",onClick:e.addEntry},null,8,["onClick"])])])),"body-cell":(0,s.w5)((e=>[(0,s.Wm)(h,{props:e,class:"table__items"},{default:(0,s.w5)((()=>[(0,s._)("span",null,(0,i.zw)(e.value),1)])),_:2},1032,["props"])])),"body-cell-actions":(0,s.w5)((t=>[(0,s.Wm)(h,{key:"actions",props:t},{default:(0,s.w5)((()=>[(0,s.Wm)(m,{flat:"",onClick:a=>e.editRecord(t.row.plateNumber),icon:"visibility",color:"primary"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{"content-style":"font-size: 14px","transition-show":"scale","transition-hide":"scale",anchor:"top middle",self:"bottom middle",offset:[10,10]},{default:(0,s.w5)((()=>[p])),_:1})])),_:2},1032,["onClick"]),(0,s.Wm)(m,{flat:"",onClick:a=>e.deleteRecord(t.row.entryId),icon:"delete",color:"negative"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{"content-style":"font-size: 14px","transition-show":"scale","transition-hide":"scale",anchor:"top middle",self:"bottom middle",offset:[10,10]},{default:(0,s.w5)((()=>[u])),_:1})])),_:2},1032,["onClick"])])),_:2},1032,["props"])])),_:1},8,["dense","columns","rows"])])}(0,s.Cn)();a(7280),a(5363);const h=(0,s.aZ)({props:{plates:Array},data(){return{columns:[{name:"type",label:"Tipo",field:e=>e.type,format:e=>"car"===e?"Auto":"van"===e?"Camioneta":"Moto",sortable:!0,align:"left"},{name:"plateNumber",label:"Patente",field:e=>e.plateNumber,format:e=>`${e.replace("_","")}`,sortable:!0,align:"left"},{name:"entryTime",label:"Horario de ingreso",field:e=>e.entryTime,format:e=>new Date(e).toLocaleString(),sortable:!0,align:"left"},{name:"cost",label:"Monto actual",field:e=>e.cost,format:e=>`$${e}`,sortable:!0,align:"left"},{name:"actions",field:"actions",label:"Acciones",align:"center"}]}},methods:{editRecord(e){this.$emit("view-photo",e)},async deleteRecord(e){this.$emit("delete-user",e)},addEntry(){this.$emit("add-entry")}}});var f=a(3040),g=a(2025),w=a(8240),y=a(3884),b=a(8870),v=a(7518),_=a.n(v);h.render=m,h.__scopeId="data-v-067c6f8a";const $=h;_()(h,"components",{QTable:f.Z,QSpace:g.Z,QBtn:w.Z,QTd:y.Z,QTooltip:b.Z});const P={class:"row q-mb-md justify-center"},S={class:"q-pt-md col-xs-12 col-sm-12 col-md-10 q-px-sm"};function N(e,t,a,o,n,l){const i=(0,s.up)("q-icon"),r=(0,s.up)("q-input");return(0,s.wg)(),(0,s.iD)("div",P,[(0,s._)("div",S,[(0,s.Wm)(r,{label:"Buscar por patente",outlined:"",dense:"",modelValue:e.searchText,"onUpdate:modelValue":[t[0]||(t[0]=t=>e.searchText=t),e.onSearchTextChange]},{append:(0,s.w5)((()=>[(0,s.Wm)(i,{name:"search"})])),_:1},8,["modelValue","onUpdate:modelValue"])])])}const T=(0,s.aZ)({props:{plates:Array},data(){return{platesFiltered:[],searchText:""}},methods:{onSearchTextChange(){console.log(this.plates),this.searchText&&""!==this.searchText?this.platesFiltered=this.plates.filter((e=>e.plateNumber.toString().toLowerCase().includes(this.searchText.toLowerCase())||e.type.toString().toLowerCase().includes(this.searchText.toLowerCase()))):this.platesFiltered=this.plates,console.log(JSON.parse(JSON.stringify(this.platesFiltered))),this.$emit("result",JSON.parse(JSON.stringify(this.platesFiltered))),0===this.platesFiltered.length&&this.$emit("search-error",JSON.parse(JSON.stringify(this.platesFiltered)))},cleanSearchBar(){this.searchText=""}}});var C=a(4842),O=a(4554);T.render=N;const q=T;_()(T,"components",{QInput:C.Z,QIcon:O.Z}),(0,s.dD)("data-v-63a3faa7");const k={class:"counter"},J={class:"counter__title"},Z={class:"counter__container-free"},E=(0,s._)("p",null,"LIBRES",-1),W={class:"counter__container-busy"},D=(0,s._)("p",null,"OCUPADOS",-1);function V(e,t,a,o,n,l){return(0,s.wg)(),(0,s.iD)("div",k,[(0,s._)("p",J,(0,i.zw)(e.title),1),(0,s._)("div",Z,[E,(0,s._)("p",null,(0,i.zw)(null===e.places.free?0:e.places.free),1)]),(0,s._)("div",W,[D,(0,s._)("p",null,(0,i.zw)(null===e.places.busy?0:e.places.busy),1)])])}(0,s.Cn)();const x=(0,s.aZ)({props:{title:String,places:{busy:Number,free:Number}}});x.render=V,x.__scopeId="data-v-63a3faa7";const I=x;(0,s.dD)("data-v-10bc7d4b");const B={ref:"imageComponent",id:"theImg"};function Q(e,t,a,o,n,l){const i=(0,s.up)("q-card"),r=(0,s.up)("q-dialog");return(0,s.wg)(),(0,s.j4)(r,{modelValue:o.card,"onUpdate:modelValue":t[0]||(t[0]=e=>o.card=e)},{default:(0,s.w5)((()=>[(0,s.Wm)(i,{class:"imageViewer"},{default:(0,s.w5)((()=>[(0,s._)("img",B,null,512)])),_:1})])),_:1},8,["modelValue"])}(0,s.Cn)();var R=a(1959);const A={setup(){const e=(0,R.iH)(!1),t=(0,R.iH)(null);return(0,s.bv)((()=>{console.log(t.value)})),{card:e,imageComponent:t}},data(){return{imageData:String}},methods:{showModal(e){this.card=!0,this.showPhoto(e)},hideModal(){this.card=!1},setImage(e){this.imageData=e,console.log(this.imageData)},showPhoto(e){setTimeout((()=>{console.log(e),this.$refs.imageComponent.src=`data:image/png;base64,${this.toBase64(e.photo.data)}`}),1)},toBase64(e){return btoa(e.reduce(((e,t)=>e+String.fromCharCode(t)),""))}}};var L=a(6778),M=a(151);A.render=Q,A.__scopeId="data-v-10bc7d4b";const F=A;_()(A,"components",{QDialog:L.Z,QCard:M.Z});var z=a(5615);function U(e){return(0,z.ZP)(`http://0.0.0.0:${e}`)}function H(e,t){e.on("active_plates_update",(()=>{t()}))}function j(e,t){e.on("new_alert",(e=>{t(e)}))}var G=a(9828);const Y=(0,s.aZ)({name:"Home",components:{TablePlates:$,SearchBar:q,PlacesCounter:I,ImageViewer:F},setup(){(0,l.Z)()},data(){return{wsNotification:!1,parkPlaces:{total:0,free:0,busy:0},motorbikePlaces:{total:0,free:0,busy:0},plates:{},activePlates:[],filteredPlates:[],emptyTable:!1}},mounted(){const e=U(5e3);H(e,this.newMessage),j(e,this.handleAlarms),this.filteredPlates=Object.values(this.plates),this.newMessage()},methods:{async newMessage(){let e,t={},a={};e=await(0,G.Z$)(),200===e.status&&(t=e.data),this.activePlates=t,e=await(0,G.m_)(),200===e.status&&(a=e.data),console.log(a),this.parkPlaces=a.carsAndVans,this.motorbikePlaces=a.motorbikes},newEntry(){console.log("nuevo ingreso")},handleAlarms(e){const t={Info:"info",Warning:"warning",Error:"negative"};e=JSON.parse(e),console.log("new Alarm: ",e),this.$q.notify({message:e.title,caption:e.description,color:t[e.type]})},filterPlates(e){this.emptyTable=!1,console.log(e),this.filteredPlates=JSON.parse(JSON.stringify(e)),console.log(JSON.parse(JSON.stringify(this.filteredPlates)),0!==JSON.parse(JSON.stringify(this.filteredPlates)).length)},showEmptyTable(){this.emptyTable=!0},async showPhoto(e){console.log(e);let t="",a=await(0,G.l8)(e);200===a.status&&(t=a.data),this.$refs.imageViewerRef.showModal(t)},async deleteEntry(e){this.$q.dialog({title:"Eliminar ingreso",message:"¿Esta seguro que desea eliminar este ingreso?",ok:{color:"negative",label:"eliminar"},cancel:{color:"accent"}}).onOk((async()=>{console.log("eliminando la entry: ",e);const t=await(0,G.pO)(e);200===t.status?(this.$refs.searchBarRef.cleanSearchBar(),await this.newMessage(),this.filteredPlates=[],this.$q.notify({progress:!0,message:"Se eliminó el ingreso correctamente",color:"accent"})):this.$q.notify({progress:!0,message:"No se ha podido eliminar el ingreso seleccionado",color:"negative"})}))}}});var K=a(4379),X=a(4899);Y.render=n;const ee=Y;_()(Y,"components",{QPage:K.Z,QBtn:w.Z,QLayout:X.Z})}}]);