"use strict";(self["webpackChunksplot_frontend"]=self["webpackChunksplot_frontend"]||[]).push([[371],{5371:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ae});var s=a(3673);const o={class:"home-header q-pa-lg"};function l(e,t,a,l,n,i){const r=(0,s.up)("PlacesCounter"),c=(0,s.up)("q-btn"),p=(0,s.up)("SearchBar"),u=(0,s.up)("TablePlates"),d=(0,s.up)("q-page"),m=(0,s.up)("image-viewer");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(d,{class:"q-pa-md"},{default:(0,s.w5)((()=>[(0,s._)("section",o,[(0,s.Wm)(r,{places:e.parkPlaces},null,8,["places"]),(0,s.Wm)(c,{color:"primary",icon:"check",label:"Añadir Ingreso",onClick:e.newEntry},null,8,["onClick"])]),(0,s.Wm)(p,{onResult:e.filterPlates,onSearchError:e.showEmptyTable,plates:JSON.parse(JSON.stringify(this.activePlates)),ref:"searchBarRef"},null,8,["onResult","onSearchError","plates"]),(0,s.Wm)(u,{plates:0!==JSON.parse(JSON.stringify(this.filteredPlates)).length?JSON.parse(JSON.stringify(this.filteredPlates)):this.emptyTable?[]:JSON.parse(JSON.stringify(this.activePlates)),onViewPhoto:e.showPhoto,onDeleteUser:e.deleteUser},null,8,["plates","onViewPhoto","onDeleteUser"])])),_:1}),(0,s.Wm)(m,{ref:"imageViewerRef"},null,512)],64)}const n={class:"q-pa-md"},i=(0,s._)("h6",null,"Lista de patentes activas",-1),r=(0,s._)("strong",null,"Ver más",-1),c=(0,s._)("strong",null,"Borrar",-1);function p(e,t,a,o,l,p){const u=(0,s.up)("q-space"),d=(0,s.up)("q-select"),m=(0,s.up)("q-tooltip"),h=(0,s.up)("q-btn"),f=(0,s.up)("q-td"),g=(0,s.up)("q-table");return(0,s.wg)(),(0,s.iD)("div",n,[(0,s.Wm)(g,{dense:e.$q.screen.lt.md,title:"Plates",columns:e.columns,rows:e.plates,"row-key":"plateNumber","rows-per-page-options":[15],"visible-columns":e.visibleColumns},{top:(0,s.w5)((()=>[i,(0,s.Wm)(u),(0,s.Wm)(d,{modelValue:e.visibleColumns,"onUpdate:modelValue":t[0]||(t[0]=t=>e.visibleColumns=t),multiple:"",outlined:"",dense:"","options-dense":"","display-value":e.$q.lang.table.columns,"emit-value":"","map-options":"",options:e.columns,"option-value":"name","options-cover":"",style:{"min-width":"150px"},color:"primary",standout:"bg-primary text-black"},null,8,["modelValue","display-value","options"])])),"body-cell-actions":(0,s.w5)((t=>[(0,s.Wm)(f,{key:"actions",props:t},{default:(0,s.w5)((()=>[(0,s.Wm)(h,{flat:"",onClick:a=>e.editRecord(t.row.plateNumber),icon:"visibility",color:"primary"},{default:(0,s.w5)((()=>[(0,s.Wm)(m,{"content-style":"font-size: 14px","transition-show":"scale","transition-hide":"scale",anchor:"top middle",self:"bottom middle",offset:[10,10]},{default:(0,s.w5)((()=>[r])),_:1})])),_:2},1032,["onClick"]),(0,s.Wm)(h,{flat:"",onClick:a=>e.deleteRecord(t.row.plateNumber),icon:"delete",color:"negative"},{default:(0,s.w5)((()=>[(0,s.Wm)(m,{"content-style":"font-size: 14px","transition-show":"scale","transition-hide":"scale",anchor:"top middle",self:"bottom middle",offset:[10,10]},{default:(0,s.w5)((()=>[c])),_:1})])),_:2},1032,["onClick"])])),_:2},1032,["props"])])),_:1},8,["dense","columns","rows","visible-columns"])])}a(7280),a(5363);const u=(0,s.aZ)({props:{plates:Array},data(){return{visibleColumns:["type","plateNumber","entryTime","cost","actions"],columns:[{name:"type",label:"Tipo",field:e=>e.type,format:e=>"car"===e?"Auto":"van"===e?"Camioneta":"Moto",sortable:!0,align:"left"},{name:"plateNumber",label:"Patente",field:e=>e.plateNumber,format:e=>`${e.replace("_","")}`,sortable:!0,align:"left"},{name:"entryTime",label:"Horario de ingreso",field:e=>e.entryTime,format:e=>new Date(e).toLocaleString(),sortable:!0,align:"left"},{name:"cost",label:"Monto actual",field:e=>e.cost,format:e=>`$${e}`,sortable:!0,align:"left"},{name:"actions",field:"actions",label:"Acciones",align:"center"}]}},methods:{editRecord(e){this.$emit("view-photo",e)},async deleteRecord(e){this.$emit("delete-user",e)}}});var d=a(6593),m=a(2025),h=a(7208),f=a(3884),g=a(4607),w=a(8870),b=a(7518),y=a.n(b);u.render=p;const v=u;y()(u,"components",{QTable:d.Z,QSpace:m.Z,QSelect:h.Z,QTd:f.Z,QBtn:g.Z,QTooltip:w.Z});const S={class:"row q-mb-md justify-center"},_={class:"q-pt-md col-xs-12 col-sm-12 col-md-10 q-px-sm"};function P(e,t,a,o,l,n){const i=(0,s.up)("q-icon"),r=(0,s.up)("q-input");return(0,s.wg)(),(0,s.iD)("div",S,[(0,s._)("div",_,[(0,s.Wm)(r,{label:"Buscar por patente",outlined:"",dense:"",modelValue:e.searchText,"onUpdate:modelValue":[t[0]||(t[0]=t=>e.searchText=t),e.onSearchTextChange]},{append:(0,s.w5)((()=>[(0,s.Wm)(i,{name:"search"})])),_:1},8,["modelValue","onUpdate:modelValue"])])])}const N=(0,s.aZ)({props:{plates:Array},data(){return{platesFiltered:[],searchText:""}},methods:{onSearchTextChange(){console.log(this.plates),this.searchText&&""!==this.searchText?this.platesFiltered=this.plates.filter((e=>e.plateNumber.toString().toLowerCase().includes(this.searchText.toLowerCase())||e.type.toString().toLowerCase().includes(this.searchText.toLowerCase()))):this.platesFiltered=this.plates,console.log(JSON.parse(JSON.stringify(this.platesFiltered))),this.$emit("result",JSON.parse(JSON.stringify(this.platesFiltered))),0===this.platesFiltered.length&&this.$emit("search-error",JSON.parse(JSON.stringify(this.platesFiltered)))},cleanSearchBar(){this.searchText=""}}});var C=a(4842),O=a(4554);N.render=P;const T=N;y()(N,"components",{QInput:C.Z,QIcon:O.Z});var $=a(2323);(0,s.dD)("data-v-3016d6f6");const q={class:"counter"},J=(0,s._)("p",{class:"counter__title"},"Lugares del establecimiento",-1),k={class:"counter__container-free"},Z=(0,s._)("p",null,"LIBRES",-1),V={class:"counter__container-busy"},W=(0,s._)("p",null,"OCUPADOS",-1);function x(e,t,a,o,l,n){return(0,s.wg)(),(0,s.iD)("div",q,[J,(0,s._)("div",k,[Z,(0,s._)("p",null,(0,$.zw)(e.places.free),1)]),(0,s._)("div",V,[W,(0,s._)("p",null,(0,$.zw)(e.places.busy),1)])])}(0,s.Cn)();const D=(0,s.aZ)({props:{places:{busy:Number,free:Number}}});D.render=x,D.__scopeId="data-v-3016d6f6";const B=D;(0,s.dD)("data-v-5b8987ca");const Q={ref:"imageComponent",id:"theImg"};function I(e,t,a,o,l,n){const i=(0,s.up)("q-card"),r=(0,s.up)("q-dialog");return(0,s.wg)(),(0,s.j4)(r,{modelValue:o.card,"onUpdate:modelValue":t[0]||(t[0]=e=>o.card=e)},{default:(0,s.w5)((()=>[(0,s.Wm)(i,{class:"imageViewer"},{default:(0,s.w5)((()=>[(0,s._)("img",Q,null,512)])),_:1})])),_:1},8,["modelValue"])}(0,s.Cn)();var R=a(1959);const E={setup(){const e=(0,R.iH)(!1),t=(0,R.iH)(null);return(0,s.bv)((()=>{console.log(t.value)})),{card:e,imageComponent:t}},data(){return{imageData:String}},methods:{showModal(e){this.card=!0,this.showPhoto(e)},hideModal(){this.card=!1},setImage(e){this.imageData=e,console.log(this.imageData)},showPhoto(e){setTimeout((()=>{console.log(e),this.$refs.imageComponent.src=`data:image/png;base64,${this.toBase64(e.photo.data)}`}),1)},toBase64(e){return btoa(e.reduce(((e,t)=>e+String.fromCharCode(t)),""))}}};var U=a(6778),L=a(151);E.render=I,E.__scopeId="data-v-5b8987ca";const M=E;y()(E,"components",{QDialog:U.Z,QCard:L.Z});var F=a(5615);function A(e){return(0,F.ZP)(`http://localhost:${e}`)}function j(e,t){e.on("active_plates_update",(()=>{t()}))}const H="http://localhost:5000";async function z(e){let t=await fetch(e),a=await t.json();return a}async function Y(){return await z(`${H}/api/v1/actives`)}async function G(){return await z(`${H}/api/v1/reports/countPlaces`)}async function K(e){const t=await z(`${H}/api/v1/vehicles/${e}`),a=await z(`${H}/api/v1/entries/?vehicleId=${t.id}`),s=await z(`${H}/api/v1/vehiclePhotos?entryId=${a[0].id}`);return await z(`${H}/api/v1/vehiclePhotos/photo/${s[0].id}`)}const X=(0,s.aZ)({name:"Home",components:{TablePlates:v,SearchBar:T,PlacesCounter:B,ImageViewer:M},data(){return{wsNotification:!1,parkPlaces:{total:0,free:0,busy:0},plates:{},activePlates:[],filteredPlates:[],emptyTable:!1}},mounted(){const e=A(5e3);j(e,this.newMessage),this.filteredPlates=Object.values(this.plates),this.newMessage()},methods:{async newMessage(){let e=await Y();this.activePlates=e,console.log(JSON.parse(JSON.stringify(this.activePlates)));let t=await G();this.parkPlaces=t},newEntry(){console.log("nuevo ingreso")},filterPlates(e){this.emptyTable=!1,console.log(e),this.filteredPlates=JSON.parse(JSON.stringify(e)),console.log(JSON.parse(JSON.stringify(this.filteredPlates)),0!==JSON.parse(JSON.stringify(this.filteredPlates)).length)},showEmptyTable(){this.emptyTable=!0},async showPhoto(e){console.log(e);const t=await K(e);this.$refs.imageViewerRef.showModal(t)},async deleteUser(e){this.$q.dialog({title:"Eliminar usuario",message:"¿Esta seguro que desea eliminar este usuario?",ok:{push:!0,color:"negative",label:"eliminar"},cancel:{push:!0,color:"secondary"}}).onOk((async()=>{const t=await this.removeUser(e);t?(this.filteredPlates=Object.values(this.plates),this.showEmptyTable(),this.$refs.searchBarRef.cleanSearchBar(),this.$q.notify({progress:!0,message:"Se eliminó el usuario correctamente",color:"accent"})):this.$q.notify({progress:!0,message:"No se ha podido eliminar el usuario seleccionado",color:"negative"})})).onCancel((async()=>{}))}}});var ee=a(4379),te=a(4899);X.render=l;const ae=X;y()(X,"components",{QPage:ee.Z,QBtn:g.Z,QLayout:te.Z})}}]);