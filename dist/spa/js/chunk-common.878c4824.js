"use strict";(self["webpackChunksplot_frontend"]=self["webpackChunksplot_frontend"]||[]).push([[64],{4256:(e,t,a)=>{a.d(t,{UC:()=>i,VY:()=>n,M2:()=>s,BF:()=>l});var o=a(5615);function i(e){return(0,o.ZP)(`http://localhost:${e}`)}function n(e,t){e.on("active_plates_update",(()=>{t()}))}function s(e,t){e.on("new_alert",(e=>{t(e)}))}function l(e,t){e.on("register_payment",(e=>{console.log(e),t(e)}))}},9828:(e,t,a)=>{a.d(t,{Z$:()=>r,m_:()=>c,l8:()=>p,pO:()=>d,s$:()=>u,_w:()=>h,kf:()=>m,IT:()=>g,qE:()=>v,ZV:()=>f,xT:()=>y,s1:()=>w,X4:()=>b});const o="http://localhost:5000",i="http://localhost:3001";async function n(e,t="GET"){let a={},o=await fetch(e,{method:`${t}`});return 200===o.status&&(a=await o.json()),{status:o.status,data:a}}async function s(e,t="POST",a){let o=await fetch(e,{method:`${t}`,headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return 200===o.status&&(a=await o.json()),{status:o.status,data:a}}async function l(e,t){let a=await fetch(`${i}/api/mqtt/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return 200===a.status&&(t=await a.json()),{status:a.status,data:t}}async function r(){return await n(`${o}/api/v1/actives`)}async function c(){return await n(`${o}/api/v1/reports/countPlaces`)}async function p(e){const t=await n(`${o}/api/v1/vehicles/${e}`);if(console.log(t),200!==t.cstatus)return t;const a=await n(`${o}/api/v1/entries/?exitTime=null&vehicleId=${t.data.id}`);if(200!==a.status)return a;console.log(a.data[0].id);const i=await n(`${o}/api/v1/vehiclePhotos?entryId=${a.data[0].id}`);return 200!==i.status?i:(console.log(i),await n(`${o}/api/v1/vehiclePhotos/photo/${i.data[0].id}`))}async function d(e){return await n(`${o}/api/v1/entries/${e}`,"DELETE")}async function u(e,t){return await s(`${o}/api/v1/entries/${e}`,"PUT",t)}async function h(e){return await s(`${o}/api/v1/payments`,"POST",e)}async function m(e){return await n(`${o}/api/v1/trafficlights?passagewayId=${e}`)}async function g(e){return await l("traffic_light",{id:e,data:"1"})}//!stats Page
async function v(e=1630805031,t=1631669031){return await n(`${o}/api/v1/reports/collected?since=${e}&until=${t}`)}async function f(e=1630805031,t=1631669031){return await n(`${o}/api/v1/reports/occupation?since=${e}&until=${t}`)}async function y(e=1630805031,t=1631669031){return await n(`${o}/api/v1/reports/paymentMethods?since=${e}&until=${t}`)}//!history page
async function w(){return await n(`${o}/api/v1/history?rowsPerPage=100&page=1`)}async function b(e){const t=await n(`${o}/api/v1/vehiclePhotos?entryId=${e}`);return 200!==t.status?t:(console.log(t),await n(`${o}/api/v1/vehiclePhotos/photo/${t.data[0].id}`))}},1836:(e,t,a)=>{a.d(t,{Z:()=>u});var o=a(3673);(0,o.dD)("data-v-ed2b6158");const i={ref:"imageComponent",id:"theImg"};function n(e,t,a,n,s,l){const r=(0,o.up)("q-card"),c=(0,o.up)("q-dialog");return(0,o.wg)(),(0,o.j4)(c,{modelValue:n.card,"onUpdate:modelValue":t[0]||(t[0]=e=>n.card=e)},{default:(0,o.w5)((()=>[(0,o.Wm)(r,{class:"imageViewer"},{default:(0,o.w5)((()=>[(0,o._)("img",i,null,512)])),_:1})])),_:1},8,["modelValue"])}(0,o.Cn)();var s=a(1959);const l={setup(){const e=(0,s.iH)(!1),t=(0,s.iH)(null);return(0,o.bv)((()=>{})),{card:e,imageComponent:t}},data(){return{imageData:String}},methods:{showModal(e){this.card=!0,this.showPhoto(e)},hideModal(){this.card=!1},showPhoto(e){setTimeout((()=>{console.log(e),this.$refs.imageComponent.src=`data:image/png;base64,${this.toBase64(e.photo.data)}`}),1)},toBase64(e){return btoa(e.reduce(((e,t)=>e+String.fromCharCode(t)),""))}}};var r=a(6778),c=a(151),p=a(7518),d=a.n(p);l.render=n,l.__scopeId="data-v-ed2b6158";const u=l;d()(l,"components",{QDialog:r.Z,QCard:c.Z})},6581:(e,t,a)=>{a.d(t,{Z:()=>l});var o=a(3673);function i(e,t,a,i,n,s){return(0,o.wg)(),(0,o.iD)("div")}var n=a(8825);const s=(0,o.aZ)({name:"NotificationOut",setup(){const e=(0,n.Z)();return{showNotif(t){e.notify({message:"Un vehículo esta listo para retirarse.",color:"primary",timeout:0,icon:"info",group:!1,position:"bottom-right",actions:[{label:"Cobrar",color:"yellow",handler:()=>{this.$emit("manage-payment",t)}}]})}}},props:{},methods:{}});s.render=i;const l=s},9821:(e,t,a)=>{a.d(t,{Z:()=>T});var o=a(3673),i=a(2323);(0,o.dD)("data-v-4f2e57d3");const n={class:"payment__image",ref:"imageComponent",id:"theImg",src:"http://www.albiladdailyeng.com/wp-content/uploads/2018/07/880x495_cmsv2_7624e743-e9f7-508f-b4f3-b3e86c31ca30-3226692.jpg"},s={style:{color:"black","padding-left":"10px"}},l={key:1,class:"payment__data-text"};function r(e,t,a,r,c,p){const d=(0,o.up)("q-input"),u=(0,o.up)("q-select"),h=(0,o.up)("q-btn"),m=(0,o.up)("q-card-actions"),g=(0,o.up)("q-card-section"),v=(0,o.up)("q-separator"),f=(0,o.up)("q-card"),y=(0,o.up)("q-dialog");return(0,o.wg)(),(0,o.j4)(y,{persistent:"",modelValue:e.dialog,"onUpdate:modelValue":t[5]||(t[5]=t=>e.dialog=t),style:{width:"75vw"}},{default:(0,o.w5)((()=>[(0,o.Wm)(f,{class:"payment"},{default:(0,o.w5)((()=>[(0,o.Wm)(g,{horizontal:""},{default:(0,o.w5)((()=>[(0,o._)("img",n,null,512),(0,o.Wm)(g,{class:"payment__data"},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{ref:"plateNumberRef",modelValue:e.plateNumber,"onUpdate:modelValue":t[0]||(t[0]=t=>e.plateNumber=t),label:"Número de patente",maxlength:"7",counter:"","reactive-rules":"",rules:[e=>e.length>=6||"Mínimo 6 caracteres"]},null,8,["modelValue","rules"]),(0,o.Wm)(u,{modelValue:e.vehicle,"onUpdate:modelValue":t[1]||(t[1]=t=>e.vehicle=t),options:e.vehicleOptions,label:"Tipo de vehículo","stack-label":""},null,8,["modelValue","options"]),(0,o.Wm)(u,{modelValue:e.payment,"onUpdate:modelValue":t[2]||(t[2]=t=>e.payment=t),options:e.paymentOptions,label:"Tipo de pago","stack-label":""},null,8,["modelValue","options"]),(0,o.Wm)(d,{color:"black","bg-color":"deep-purple-2",modelValue:e.cost,"onUpdate:modelValue":t[3]||(t[3]=t=>e.cost=t),outlined:"",prefix:"$",label:"Monto a cobrar",placeholder:"","input-style":{"font-size":"1.2rem"},rules:[e=>e>=0||"El valor no puede ser negativo"],"reactive-rules":"",type:"number",style:{"padding-top":"10px"}},{label:(0,o.w5)((()=>[(0,o._)("span",s,"Monto a cobrar ($"+(0,i.zw)(e.initialCost)+")",1)])),_:1},8,["modelValue","input-style","rules"]),"Efectivo"===e.payment?((0,o.wg)(),(0,o.j4)(d,{key:0,modelValue:e.moneyReceived,"onUpdate:modelValue":t[4]||(t[4]=t=>e.moneyReceived=t),label:"Paga con:",prefix:"$"},null,8,["modelValue"])):(0,o.kq)("",!0),"Efectivo"===e.payment&&""!==e.moneyReceived?((0,o.wg)(),(0,o.iD)("h6",l,"Vuelto: $"+(0,i.zw)(parseFloat(e.moneyReceived)-parseFloat(e.cost)),1)):(0,o.kq)("",!0),(0,o.Wm)(m,{align:"right"},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{flat:"",color:"primary",label:"Cobrar",onClick:e.makePayment},null,8,["onClick"])])),_:1})])),_:1})])),_:1}),(0,o.Wm)(v)])),_:1})])),_:1},8,["modelValue"])}(0,o.Cn)();var c=a(515),p=a.n(c),d=a(8825),u=a(1959);const h=(0,o.aZ)({name:"PaymentDialog",setup(){(0,d.Z)();return{dialog:(0,u.iH)(!1),plateNumber:(0,u.iH)(""),initialCost:(0,u.iH)("0"),moneyReceived:(0,u.iH)(""),vehicle:(0,u.iH)("Motocicleta"),payment:(0,u.iH)("Efectivo"),cost:(0,u.iH)("0"),vehicleOptions:["Auto","Camioneta","Motocicleta"],paymentOptions:["Efectivo","Tarjeta de credito","Tajeta de debito"]}},data(){return{imageData:String,vehicleData:{}}},props:{},methods:{makePayment(){if(this.checkConditions()){console.log("realizando pago");const e=p()(p()({},this.vehicleData),{},{cost:this.cost,computePayment:!1,exitTime:(new Date).getTime(),method:"Efectivo"===this.payment?"Cash":"Tarjeta de credito"===this.payment?"Credit Card":"Debit Card"});console.log(this.vehicleData),Object.keys(this.vehicleData).length>0&&this.vehicleData.plateNumber.toUpperCase()!==this.plateNumber.toUpperCase()&&(e.plateNumber=this.plateNumber.toUpperCase()),Object.keys(this.vehicleData).length>0&&6===e.plateNumber.length&&(e.plateNumber+="_"),console.log(e),this.$emit("payment-realized",e),this.hideDialog()}else this.$refs.plateNumberRef.validate()},showDialog(e,t){this.dialog=!0,void 0!==t&&""!==t&&(console.log("en el dialog: ",t),this.vehicleData=t,this.cost=t.cost,this.initialCost=t.cost,"car"===t.type?this.vehicle="Auto":"van"===t.type?this.vehicle="Camioneta":this.vehicle="Motocicleta",this.plateNumber=t.plateNumber),void 0!==e&&""!==e&&this.showPhoto(e)},hideDialog(){this.plateNumber="",this.moneyReceived="",this.vehicle="Motocicleta",this.payment="Efectivo",this.dialog=!1},showPhoto(e){setTimeout((()=>{console.log(e),this.$refs.imageComponent.src=`data:image/png;base64,${this.toBase64(e.photo.data)}`}),1)},toBase64(e){return btoa(e.reduce(((e,t)=>e+String.fromCharCode(t)),""))},checkConditions(){return this.plateNumber.length>=6&&this.plateNumber.length<=7}}});var m=a(6778),g=a(151),v=a(5589),f=a(4842),y=a(8516),w=a(9367),b=a(8240),$=a(5869),C=a(7518),_=a.n(C);h.render=r,h.__scopeId="data-v-4f2e57d3";const T=h;_()(h,"components",{QDialog:m.Z,QCard:g.Z,QCardSection:v.Z,QInput:f.Z,QSelect:y.Z,QCardActions:w.Z,QBtn:b.Z,QSeparator:$.Z})},2785:(e,t,a)=>{a.d(t,{Z:()=>u});var o=a(3673);const i={class:"row q-mb-md justify-center"},n={class:"q-pt-md col-xs-12 col-sm-12 col-md-10 q-px-sm"};function s(e,t,a,s,l,r){const c=(0,o.up)("q-icon"),p=(0,o.up)("q-input");return(0,o.wg)(),(0,o.iD)("div",i,[(0,o._)("div",n,[(0,o.Wm)(p,{label:"Buscar por patente",outlined:"",dense:"",modelValue:e.searchText,"onUpdate:modelValue":[t[0]||(t[0]=t=>e.searchText=t),e.onSearchTextChange]},{append:(0,o.w5)((()=>[(0,o.Wm)(c,{name:"search"})])),_:1},8,["modelValue","onUpdate:modelValue"])])])}const l=(0,o.aZ)({props:{plates:Array},data(){return{platesFiltered:[],searchText:""}},methods:{onSearchTextChange(){this.searchText&&""!==this.searchText?this.platesFiltered=this.plates.filter((e=>e.plateNumber.toString().toLowerCase().includes(this.searchText.toLowerCase())||e.type.toString().toLowerCase().includes(this.searchText.toLowerCase()))):this.platesFiltered=this.plates,this.$emit("result",JSON.parse(JSON.stringify(this.platesFiltered))),0===this.platesFiltered.length&&this.$emit("search-error",JSON.parse(JSON.stringify(this.platesFiltered)))},cleanSearchBar(){this.searchText=""}}});var r=a(4842),c=a(4554),p=a(7518),d=a.n(p);l.render=s;const u=l;d()(l,"components",{QInput:r.Z,QIcon:c.Z})}}]);